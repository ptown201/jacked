<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Polaris Workout">
    <meta name="theme-color" content="#764ba2">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23764ba2' width='100' height='100'/><text y='75' font-size='70' text-anchor='middle' x='50'>üí™</text></svg>">
    <title>Polaris - Get Jacked Plan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .header {
                margin-bottom: 30px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            min-height: 44px;
            flex: 1;
            min-width: 100px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }

        @media (min-width: 768px) {
            .tab {
                padding: 12px 24px;
                font-size: 16px;
                flex: initial;
            }
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .tab.active {
            background: #764ba2;
            color: white;
        }

        .content {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @media (min-width: 768px) {
            .content {
                padding: 30px;
            }
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .workout-plan {
            display: grid;
            gap: 20px;
        }

        .day-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .day-card:hover {
            border-color: #764ba2;
            box-shadow: 0 4px 12px rgba(118, 75, 162, 0.2);
        }

        .day-card h3 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .exercise {
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-name {
            font-weight: 600;
            color: #333;
        }

        .exercise-details {
            color: #666;
            font-size: 0.9em;
        }

        .log-workout-section {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
            background-color: white;
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #764ba2;
        }

        /* Ensure dropdowns work on iOS */
        select {
            cursor: pointer;
            touch-action: manipulation;
        }

        /* Better number input for mobile */
        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .sets-container {
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }

        .set-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            align-items: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
        }

        .set-input label {
            grid-column: 1 / -1;
            margin-bottom: 0;
        }

        .set-input .btn-small {
            grid-column: 1 / -1;
        }

        @media (min-width: 768px) {
            .set-input {
                grid-template-columns: auto 1fr 1fr auto;
            }

            .set-input label {
                grid-column: initial;
            }

            .set-input .btn-small {
                grid-column: initial;
            }
        }

        .btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }

        .btn:hover {
            background: #5a3880;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
            width: auto;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .progress-chart {
            height: 300px;
            position: relative;
        }

        .exercise-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .exercise-btn {
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 14px;
        }

        .exercise-btn:hover {
            border-color: #764ba2;
            background: #fff;
        }

        .exercise-btn.selected {
            background: #764ba2;
            color: white;
            border-color: #764ba2;
        }

        .history-list {
            display: grid;
            gap: 15px;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }

        .history-date {
            font-weight: 600;
            color: #764ba2;
            margin-bottom: 8px;
        }

        .history-exercise {
            color: #333;
            font-size: 0.95em;
        }

        canvas {
            max-height: 300px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ Polaris - Get Jacked Plan</h1>
            <p>Hotel Gym Edition</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('generator', event)">Focus Area</button>
            <button class="tab" onclick="showSection('log', event)">Log Workout</button>
            <button class="tab" onclick="showSection('dashboard', event)">Progress Dashboard</button>
            <button class="tab" onclick="showSection('history', event)">Workout History</button>
            <button class="tab" onclick="showSection('bodycomp', event)">Body Composition</button>
            <button class="tab" onclick="showSection('settings', event)">Settings</button>
        </div>

        <div class="content">
            <!-- Custom Workout Generator Section -->
            <div id="generator" class="section active">
                <h2 style="margin-bottom: 20px;">Focus Area Workout Generator</h2>
                
                <div class="log-workout-section">
                    <div class="form-group">
                        <label>Select Focus Area</label>
                        <select id="focusArea" onchange="generateCustomWorkout()">
                            <option value="">Choose focus area...</option>
                            <option value="upper-body">Upper Body Strength</option>
                            <option value="lower-body">Lower Body Strength</option>
                            <option value="full-body">Full Body</option>
                            <option value="chest-arms">Chest & Arms</option>
                            <option value="back-shoulders">Back & Shoulders</option>
                            <option value="legs-glutes">Legs & Glutes</option>
                            <option value="cardio-hiit">Cardio & HIIT</option>
                            <option value="core-abs">Core & Abs</option>
                        </select>
                    </div>

                    <div id="customWorkoutDisplay" style="margin-top: 30px;"></div>
                </div>
            </div>

            <!-- Log Workout Section -->
            <div id="log" class="section">
                <div class="log-workout-section">
                    <h2 style="margin-bottom: 20px;">Log Your Workout</h2>
                    
                    <div id="successMessage" class="success-message">
                        Workout logged successfully! üéâ
                    </div>

                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="workoutDate">
                    </div>

                    <div class="form-group" id="focusExerciseGroup" style="display: none;">
                        <label>Focus Area Exercises</label>
                        <select id="focusExerciseSelect" onchange="handleExerciseChange()">
                            <option value="">Choose from your focus area...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Additional Exercises</label>
                        <select id="exerciseSelect" onchange="handleExerciseChange()">
                            <option value="">Choose an exercise...</option>
                            <optgroup label="Chest & Triceps">
                                <option value="Dumbbell Bench Press">Dumbbell Bench Press</option>
                                <option value="Cable Chest Fly">Cable Chest Fly</option>
                                <option value="Incline Dumbbell Press">Incline Dumbbell Press</option>
                                <option value="Cable Tricep Pushdown">Cable Tricep Pushdown</option>
                                <option value="Dumbbell Overhead Tricep Extension">Dumbbell Overhead Tricep Extension</option>
                            </optgroup>
                            <optgroup label="Back & Biceps">
                                <option value="Cable Lat Pulldown">Cable Lat Pulldown</option>
                                <option value="Dumbbell Bent Over Row">Dumbbell Bent Over Row</option>
                                <option value="Cable Seated Row">Cable Seated Row</option>
                                <option value="Dumbbell Bicep Curl">Dumbbell Bicep Curl</option>
                                <option value="Cable Hammer Curl">Cable Hammer Curl</option>
                            </optgroup>
                            <optgroup label="Legs">
                                <option value="Dumbbell Goblet Squat">Dumbbell Goblet Squat</option>
                                <option value="Dumbbell Romanian Deadlift">Dumbbell Romanian Deadlift</option>
                                <option value="Leg Extension Machine">Leg Extension Machine</option>
                                <option value="Dumbbell Lunges">Dumbbell Lunges</option>
                                <option value="Cable Pull Through">Cable Pull Through</option>
                                <option value="Dumbbell Calf Raise">Dumbbell Calf Raise</option>
                            </optgroup>
                            <optgroup label="Shoulders & Abs">
                                <option value="Dumbbell Shoulder Press">Dumbbell Shoulder Press</option>
                                <option value="Shoulder Press Machine">Shoulder Press Machine</option>
                                <option value="Dumbbell Lateral Raise">Dumbbell Lateral Raise</option>
                                <option value="Cable Face Pull">Cable Face Pull</option>
                                <option value="Cable Wood Chop">Cable Wood Chop</option>
                                <option value="Cable Crunch">Cable Crunch</option>
                            </optgroup>
                            <optgroup label="Cardio">
                                <option value="Treadmill Running" data-cardio="true">Treadmill Running</option>
                                <option value="Treadmill Incline Walk" data-cardio="true">Treadmill Incline Walk</option>
                                <option value="Peloton Bike HIIT" data-cardio="true">Peloton Bike HIIT</option>
                                <option value="Peloton Bike Endurance" data-cardio="true">Peloton Bike Endurance</option>
                                <option value="Rower HIIT" data-cardio="true">Rower HIIT</option>
                                <option value="Rower Steady State" data-cardio="true">Rower Steady State</option>
                            </optgroup>
                        </select>
                    </div>

                    <div id="previousDataNote" style="display: none; background: #e3f2fd; color: #1976d2; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 14px;">
                        üìù Previous workout data loaded. Adjust as needed.
                    </div>

                    <div id="strengthSets" class="form-group">
                        <label>Sets</label>
                        <div id="setsContainer" class="sets-container"></div>
                        <button class="btn btn-secondary" onclick="addSet()">+ Add Set</button>
                    </div>

                    <div id="cardioInput" class="form-group" style="display: none;">
                        <label>Duration (minutes)</label>
                        <input type="number" id="cardioDuration" placeholder="30" min="1" step="1">
                        
                        <label style="margin-top: 15px;">Distance (miles - optional)</label>
                        <input type="number" id="cardioDistance" placeholder="3.5" min="0" step="0.1">
                        
                        <label style="margin-top: 15px;">Average Heart Rate (optional)</label>
                        <input type="number" id="cardioHR" placeholder="145" min="0" step="1">
                        
                        <label style="margin-top: 15px;">Calories Burned (optional)</label>
                        <input type="number" id="cardioCalories" placeholder="350" min="0" step="1">
                    </div>

                    <button class="btn" onclick="logWorkout()">Log Workout</button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <h2 style="margin-bottom: 20px;">Progress Dashboard</h2>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Workouts</h3>
                        <div class="value" id="totalWorkouts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>This Week</h3>
                        <div class="value" id="weekWorkouts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Volume (lbs)</h3>
                        <div class="value" id="totalVolume">0</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Exercise Progress</div>
                    <div class="form-group">
                        <select id="chartExerciseSelect" onchange="updateChart()">
                            <option value="">Select exercise to view progress...</option>
                            <option value="Dumbbell Bench Press">Dumbbell Bench Press</option>
                            <option value="Cable Lat Pulldown">Cable Lat Pulldown</option>
                            <option value="Dumbbell Goblet Squat">Dumbbell Goblet Squat</option>
                            <option value="Dumbbell Shoulder Press">Dumbbell Shoulder Press</option>
                            <option value="Shoulder Press Machine">Shoulder Press Machine</option>
                            <option value="Dumbbell Bent Over Row">Dumbbell Bent Over Row</option>
                            <option value="Dumbbell Romanian Deadlift">Dumbbell Romanian Deadlift</option>
                            <option value="Leg Extension Machine">Leg Extension Machine</option>
                            <option value="Dumbbell Bicep Curl">Dumbbell Bicep Curl</option>
                            <option value="Cable Tricep Pushdown">Cable Tricep Pushdown</option>
                        </select>
                    </div>
                    <div class="progress-chart">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Weekly Volume</div>
                    <div class="progress-chart">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- History Section -->
            <div id="history" class="section">
                <h2 style="margin-bottom: 20px;">Workout History</h2>
                <div id="historyList" class="history-list">
                    <p style="text-align: center; color: #999; padding: 40px;">No workouts logged yet. Start by logging your first workout!</p>
                </div>
            </div>
            <!-- Body Composition History Section -->
            <div id="bodycomp" class="section">
                <h2 style="margin-bottom: 20px;">Body Composition History</h2>
                
                <div class="log-workout-section" style="max-width: 500px;">
                    <div id="bodyWeightSuccess" class="success-message">
                        Body weight logged successfully! üéâ
                    </div>

                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="bodyWeightDate">
                    </div>

                    <div class="form-group">
                        <label>Body Weight (lbs)</label>
                        <input type="number" id="bodyWeight" placeholder="185" min="50" max="500" step="0.1">
                    </div>

                    <button class="btn" onclick="logBodyWeight()">Log Body Weight</button>
                </div>

                <div class="chart-container" style="margin-top: 40px;">
                    <div class="chart-title">Body Weight History</div>
                    <div class="progress-chart">
                        <canvas id="bodyWeightChart"></canvas>
                    </div>
                </div>

                <div id="bodyWeightHistoryList" class="history-list" style="margin-top: 30px;">
                    <p style="text-align: center; color: #999; padding: 40px;">No body weight entries yet. Start tracking your progress!</p>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="section">
                <h2 style="margin-bottom: 20px;">Settings & Data Management</h2>
                
                <div class="log-workout-section" style="max-width: 600px;">
                    
                    <div class="day-card" style="margin-bottom: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <h3 style="margin-bottom: 15px; color: white;">üì± Add to iPhone Home Screen</h3>
                        <p style="color: white; margin-bottom: 15px; font-weight: 500;">
                            Make this app easily accessible from your home screen:
                        </p>
                        <ol style="color: white; margin-left: 20px; line-height: 2; font-size: 15px;">
                            <li><strong>Open this page in Safari</strong> (not Chrome or other browsers)</li>
                            <li>Tap the <strong>Share button</strong> <span style="font-size: 24px;">‚éã</span> at the bottom of the screen</li>
                            <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
                            <li>Tap <strong>"Add"</strong> in the top right corner</li>
                            <li>Find the app on your home screen with the üí™ icon!</li>
                        </ol>
                        <p style="color: white; margin-top: 15px; font-style: italic; font-size: 14px;">
                            ‚ú® Once added, it will work like a native app - no browser bars, just your workout tracker!
                        </p>
                    </div>

                    <div class="day-card" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üíæ Export Data</h3>
                        <p style="color: #666; margin-bottom: 15px;">
                            Save your workout and body weight data to a file on your iPhone. You can store it in Files, iCloud Drive, or any location you choose.
                        </p>
                        <button class="btn" onclick="exportData()">Export All Data</button>
                    </div>

                    <div class="day-card" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üì• Import Data</h3>
                        <p style="color: #666; margin-bottom: 15px;">
                            Restore your data from a previously exported file. This will merge with your existing data.
                        </p>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Import Data</button>
                    </div>

                    <div class="day-card" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üìä Data Summary</h3>
                        <div style="color: #666; line-height: 1.8;">
                            <strong>Total Workouts:</strong> <span id="settingsWorkoutCount">0</span><br>
                            <strong>Body Weight Entries:</strong> <span id="settingsBodyWeightCount">0</span><br>
                            <strong>Storage:</strong> Using iPhone local storage (localStorage)
                        </div>
                    </div>

                    <div class="day-card" style="border-color: #e74c3c;">
                        <h3 style="margin-bottom: 15px; color: #e74c3c;">üóëÔ∏è Clear All Data</h3>
                        <p style="color: #666; margin-bottom: 15px;">
                            This will permanently delete all your workouts and body weight data. This action cannot be undone!
                        </p>
                        <button class="btn" onclick="clearAllData()" style="background: #e74c3c;">Clear All Data</button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let workouts = JSON.parse(localStorage.getItem('workouts')) || [];
        let bodyWeights = JSON.parse(localStorage.getItem('bodyWeights')) || [];
        let progressChart = null;
        let volumeChart = null;
        let bodyWeightChart = null;
        let currentFocusArea = null;

        const workoutLibrary = {
            'upper-body': {
                name: 'Upper Body Strength',
                exercises: [
                    { name: 'Dumbbell Bench Press', sets: '4 sets √ó 8-10 reps' },
                    { name: 'Cable Lat Pulldown', sets: '4 sets √ó 10-12 reps' },
                    { name: 'Shoulder Press Machine', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Cable Seated Row', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Dumbbell Bicep Curl', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Cable Tricep Pushdown', sets: '3 sets √ó 12-15 reps' }
                ]
            },
            'lower-body': {
                name: 'Lower Body Strength',
                exercises: [
                    { name: 'Dumbbell Goblet Squat', sets: '4 sets √ó 10-12 reps' },
                    { name: 'Dumbbell Romanian Deadlift', sets: '4 sets √ó 10-12 reps' },
                    { name: 'Leg Extension Machine', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Dumbbell Lunges', sets: '3 sets √ó 12 reps each leg' },
                    { name: 'Cable Pull Through', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Dumbbell Calf Raise', sets: '3 sets √ó 15-20 reps' }
                ]
            },
            'full-body': {
                name: 'Full Body Workout',
                exercises: [
                    { name: 'Dumbbell Goblet Squat', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Dumbbell Bench Press', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Cable Lat Pulldown', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Shoulder Press Machine', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Dumbbell Romanian Deadlift', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Cable Crunch', sets: '3 sets √ó 15-20 reps' }
                ]
            },
            'chest-arms': {
                name: 'Chest & Arms Focus',
                exercises: [
                    { name: 'Dumbbell Bench Press', sets: '4 sets √ó 8-12 reps' },
                    { name: 'Incline Dumbbell Press', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Cable Chest Fly', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Dumbbell Bicep Curl', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Cable Tricep Pushdown', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Dumbbell Overhead Tricep Extension', sets: '3 sets √ó 10-12 reps' }
                ]
            },
            'back-shoulders': {
                name: 'Back & Shoulders Focus',
                exercises: [
                    { name: 'Cable Lat Pulldown', sets: '4 sets √ó 8-12 reps' },
                    { name: 'Dumbbell Bent Over Row', sets: '4 sets √ó 10-12 reps' },
                    { name: 'Shoulder Press Machine', sets: '3 sets √ó 10-12 reps' },
                    { name: 'Cable Face Pull', sets: '3 sets √ó 15-20 reps' },
                    { name: 'Dumbbell Lateral Raise', sets: '3 sets √ó 12-15 reps' },
                    { name: 'Cable Seated Row', sets: '3 sets √ó 10-12 reps' }
                ]
            },
            'legs-glutes': {
                name: 'Legs & Glutes Focus',
                exercises: [
                    { name: 'Dumbbell Goblet Squat', sets: '4 sets √ó 12-15 reps' },
                    { name: 'Dumbbell Romanian Deadlift', sets: '4 sets √ó 12-15 reps' },
                    { name: 'Leg Extension Machine', sets: '4 sets √ó 12-15 reps' },
                    { name: 'Dumbbell Lunges', sets: '4 sets √ó 12 reps each leg' },
                    { name: 'Cable Pull Through', sets: '3 sets √ó 15-20 reps' },
                    { name: 'Dumbbell Calf Raise', sets: '4 sets √ó 15-20 reps' }
                ]
            },
            'cardio-hiit': {
                name: 'Cardio & HIIT',
                exercises: [
                    { name: 'Rower HIIT', sets: '20 min (500m sprint, 1 min rest)' },
                    { name: 'Treadmill Running', sets: '5 min warmup + 20 min intervals (1 min sprint, 2 min jog)' },
                    { name: 'Peloton Bike HIIT', sets: '20-30 minutes HIIT intervals' },
                    { name: 'Dumbbell Goblet Squat', sets: '3 sets √ó 15 reps' },
                    { name: 'Cable Wood Chop', sets: '3 sets √ó 15 reps each side' },
                    { name: 'Cable Crunch', sets: '3 sets √ó 20 reps' }
                ]
            },
            'core-abs': {
                name: 'Core & Abs Focus',
                exercises: [
                    { name: 'Cable Crunch', sets: '4 sets √ó 15-20 reps' },
                    { name: 'Cable Wood Chop', sets: '4 sets √ó 12-15 reps each side' },
                    { name: 'Cable Face Pull', sets: '3 sets √ó 15-20 reps (core stabilization)' },
                    { name: 'Dumbbell Goblet Squat', sets: '3 sets √ó 12-15 reps (core engagement)' },
                    { name: 'Rower Steady State', sets: '15-20 minutes moderate pace' }
                ]
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('workoutDate').valueAsDate = new Date();
            document.getElementById('bodyWeightDate').valueAsDate = new Date();
            addSet();
            addSet();
            addSet();
            updateDashboard();
            updateHistory();
        });

        function generateCustomWorkout() {
            const focusArea = document.getElementById('focusArea').value;
            const display = document.getElementById('customWorkoutDisplay');
            
            if (!focusArea) {
                display.innerHTML = '';
                document.getElementById('focusExerciseGroup').style.display = 'none';
                currentFocusArea = null;
                return;
            }

            const workout = workoutLibrary[focusArea];
            currentFocusArea = focusArea;
            
            // Populate the focus exercises dropdown
            const focusExerciseSelect = document.getElementById('focusExerciseSelect');
            focusExerciseSelect.innerHTML = '<option value="">Choose from your focus area...</option>';
            
            workout.exercises.forEach(ex => {
                const option = document.createElement('option');
                option.value = ex.name;
                option.textContent = ex.name;
                
                // Check if it's a cardio exercise
                if (ex.name.includes('Treadmill') || ex.name.includes('Peloton') || ex.name.includes('Rower')) {
                    option.setAttribute('data-cardio', 'true');
                }
                
                focusExerciseSelect.appendChild(option);
            });
            
            // Show the focus exercise group
            document.getElementById('focusExerciseGroup').style.display = 'block';
            
            let html = `
                <div class="day-card">
                    <h3>${workout.name}</h3>
                    ${workout.exercises.map(ex => `
                        <div class="exercise">
                            <div>
                                <div class="exercise-name">${ex.name}</div>
                                <div class="exercise-details">${ex.sets}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            display.innerHTML = html;
        }

        function handleExerciseChange() {
            // Check focus exercise select first
            const focusSelect = document.getElementById('focusExerciseSelect');
            const additionalSelect = document.getElementById('exerciseSelect');
            
            let selectedOption = null;
            let isCardio = false;
            let exerciseName = '';
            
            // Determine which dropdown was used
            if (focusSelect.value) {
                selectedOption = focusSelect.options[focusSelect.selectedIndex];
                isCardio = selectedOption.getAttribute('data-cardio') === 'true';
                exerciseName = focusSelect.value;
                // Clear the other dropdown
                additionalSelect.value = '';
            } else if (additionalSelect.value) {
                selectedOption = additionalSelect.options[additionalSelect.selectedIndex];
                isCardio = selectedOption.getAttribute('data-cardio') === 'true';
                exerciseName = additionalSelect.value;
                // Clear the other dropdown
                focusSelect.value = '';
            }
            
            const strengthSets = document.getElementById('strengthSets');
            const cardioInput = document.getElementById('cardioInput');
            
            if (isCardio) {
                strengthSets.style.display = 'none';
                cardioInput.style.display = 'block';
                
                // Load previous cardio data
                loadPreviousCardioData(exerciseName);
            } else {
                strengthSets.style.display = 'block';
                cardioInput.style.display = 'none';
                
                // Load previous sets data
                loadPreviousSetsData(exerciseName);
            }
        }

        function loadPreviousSetsData(exerciseName) {
            // Find the most recent workout for this exercise
            const previousWorkouts = workouts
                .filter(w => w.exercise === exerciseName && w.type === 'strength' && w.sets)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (previousWorkouts.length === 0) {
                document.getElementById('previousDataNote').style.display = 'none';
                return;
            }
            
            // Show note
            document.getElementById('previousDataNote').style.display = 'block';
            
            const lastWorkout = previousWorkouts[0];
            const setsContainer = document.getElementById('setsContainer');
            
            // Clear current sets
            setsContainer.innerHTML = '';
            
            // Add sets from previous workout
            lastWorkout.sets.forEach(set => {
                const setNumber = setsContainer.children.length + 1;
                const setDiv = document.createElement('div');
                setDiv.className = 'set-input';
                setDiv.innerHTML = `
                    <label>Set ${setNumber}</label>
                    <input type="number" placeholder="Weight (lbs)" class="set-weight" min="0" step="5" value="${set.weight}">
                    <input type="number" placeholder="Reps" class="set-reps" min="0" step="1" value="${set.reps}">
                    <button class="btn btn-small btn-secondary" onclick="removeSet(this)">‚úï</button>
                `;
                setsContainer.appendChild(setDiv);
            });
        }

        function loadPreviousCardioData(exerciseName) {
            // Find the most recent cardio workout for this exercise
            const previousWorkouts = workouts
                .filter(w => w.exercise === exerciseName && w.type === 'cardio' && w.cardioData)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (previousWorkouts.length === 0) {
                document.getElementById('previousDataNote').style.display = 'none';
                return;
            }
            
            // Show note
            document.getElementById('previousDataNote').style.display = 'block';
            
            const lastWorkout = previousWorkouts[0];
            const cd = lastWorkout.cardioData;
            
            document.getElementById('cardioDuration').value = cd.duration || '';
            document.getElementById('cardioDistance').value = cd.distance || '';
            document.getElementById('cardioHR').value = cd.avgHeartRate || '';
            document.getElementById('cardioCalories').value = cd.calories || '';
        }

        function addSet() {
            const container = document.getElementById('setsContainer');
            const setNumber = container.children.length + 1;
            
            const setDiv = document.createElement('div');
            setDiv.className = 'set-input';
            setDiv.innerHTML = `
                <label>Set ${setNumber}</label>
                <input type="number" placeholder="Weight (lbs)" class="set-weight" min="0" step="5">
                <input type="number" placeholder="Reps" class="set-reps" min="0" step="1">
                <button class="btn btn-small btn-secondary" onclick="removeSet(this)">‚úï</button>
            `;
            container.appendChild(setDiv);
        }

        function removeSet(button) {
            button.parentElement.remove();
            updateSetNumbers();
        }

        function updateSetNumbers() {
            const sets = document.querySelectorAll('.set-input');
            sets.forEach((set, index) => {
                set.querySelector('label').textContent = `Set ${index + 1}`;
            });
        }

        function logWorkout() {
            const date = document.getElementById('workoutDate').value;
            
            // Check both dropdowns for selected exercise
            const focusExercise = document.getElementById('focusExerciseSelect').value;
            const additionalExercise = document.getElementById('exerciseSelect').value;
            const exercise = focusExercise || additionalExercise;
            
            if (!date || !exercise) {
                alert('Please select a date and exercise');
                return;
            }

            // Determine which dropdown was used to get the correct option
            let selectedOption;
            let isCardio = false;
            
            if (focusExercise) {
                selectedOption = document.getElementById('focusExerciseSelect').options[document.getElementById('focusExerciseSelect').selectedIndex];
                isCardio = selectedOption.getAttribute('data-cardio') === 'true';
            } else {
                selectedOption = document.getElementById('exerciseSelect').options[document.getElementById('exerciseSelect').selectedIndex];
                isCardio = selectedOption.getAttribute('data-cardio') === 'true';
            }

            let workout = {
                id: Date.now(),
                date,
                exercise,
                type: isCardio ? 'cardio' : 'strength'
            };

            if (isCardio) {
                const duration = parseInt(document.getElementById('cardioDuration').value);
                const distance = parseFloat(document.getElementById('cardioDistance').value);
                const hr = parseInt(document.getElementById('cardioHR').value);
                const calories = parseInt(document.getElementById('cardioCalories').value);

                if (!duration) {
                    alert('Please enter duration for cardio exercise');
                    return;
                }

                workout.cardioData = {
                    duration,
                    distance: distance || null,
                    avgHeartRate: hr || null,
                    calories: calories || null
                };
            } else {
                const setInputs = document.querySelectorAll('.set-input');
                const sets = [];
                let hasValidSet = false;

                setInputs.forEach(setInput => {
                    const weight = parseFloat(setInput.querySelector('.set-weight').value);
                    const reps = parseInt(setInput.querySelector('.set-reps').value);
                    
                    if (weight && reps) {
                        sets.push({ weight, reps });
                        hasValidSet = true;
                    }
                });

                if (!hasValidSet) {
                    alert('Please enter at least one complete set (weight and reps)');
                    return;
                }

                workout.sets = sets;
            }

            workouts.push(workout);
            localStorage.setItem('workouts', JSON.stringify(workouts));

            // Show success message
            const successMsg = document.getElementById('successMessage');
            successMsg.classList.add('show');
            setTimeout(() => successMsg.classList.remove('show'), 3000);

            // Reset form
            document.getElementById('focusExerciseSelect').value = '';
            document.getElementById('exerciseSelect').value = '';
            document.getElementById('setsContainer').innerHTML = '';
            document.getElementById('cardioDuration').value = '';
            document.getElementById('cardioDistance').value = '';
            document.getElementById('cardioHR').value = '';
            document.getElementById('cardioCalories').value = '';
            document.getElementById('strengthSets').style.display = 'block';
            document.getElementById('cardioInput').style.display = 'none';
            addSet();
            addSet();
            addSet();
        }

        function updateDashboard() {
            // Calculate stats
            const totalWorkouts = workouts.length;
            
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const weekWorkouts = workouts.filter(w => new Date(w.date) >= oneWeekAgo).length;
            
            const totalVolume = workouts.reduce((sum, workout) => {
                if (workout.type === 'strength' && workout.sets) {
                    return sum + workout.sets.reduce((setSum, set) => setSum + (set.weight * set.reps), 0);
                }
                return sum;
            }, 0);

            document.getElementById('totalWorkouts').textContent = totalWorkouts;
            document.getElementById('weekWorkouts').textContent = weekWorkouts;
            document.getElementById('totalVolume').textContent = totalVolume.toLocaleString();

            // Update charts
            updateVolumeChart();
        }

        function updateChart() {
            const exercise = document.getElementById('chartExerciseSelect').value;
            if (!exercise) return;

            const exerciseWorkouts = workouts
                .filter(w => w.exercise === exercise)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            if (exerciseWorkouts.length === 0) {
                if (progressChart) {
                    progressChart.destroy();
                    progressChart = null;
                }
                return;
            }

            const dates = exerciseWorkouts.map(w => new Date(w.date).toLocaleDateString());
            const maxWeights = exerciseWorkouts.map(w => Math.max(...w.sets.map(s => s.weight)));
            const volumes = exerciseWorkouts.map(w => 
                w.sets.reduce((sum, set) => sum + (set.weight * set.reps), 0)
            );

            const ctx = document.getElementById('progressChart').getContext('2d');

            if (progressChart) {
                progressChart.destroy();
            }

            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Max Weight (lbs)',
                        data: maxWeights,
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'Total Volume (lbs)',
                        data: volumes,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Max Weight (lbs)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Volume (lbs)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }

        function updateVolumeChart() {
            const last8Weeks = [];
            const today = new Date();
            
            for (let i = 7; i >= 0; i--) {
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - (i * 7 + 7));
                const weekEnd = new Date(today);
                weekEnd.setDate(today.getDate() - (i * 7));
                
                const weekVolume = workouts
                    .filter(w => {
                        const workoutDate = new Date(w.date);
                        return workoutDate >= weekStart && workoutDate < weekEnd;
                    })
                    .reduce((sum, workout) => {
                        if (workout.type === 'strength' && workout.sets) {
                            return sum + workout.sets.reduce((setSum, set) => setSum + (set.weight * set.reps), 0);
                        }
                        return sum;
                    }, 0);
                
                last8Weeks.push({
                    label: `${weekStart.getMonth() + 1}/${weekStart.getDate()}`,
                    volume: weekVolume
                });
            }

            const ctx = document.getElementById('volumeChart').getContext('2d');

            if (volumeChart) {
                volumeChart.destroy();
            }

            volumeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: last8Weeks.map(w => w.label),
                    datasets: [{
                        label: 'Weekly Volume (lbs)',
                        data: last8Weeks.map(w => w.volume),
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: '#764ba2',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Volume (lbs)'
                            }
                        }
                    }
                }
            });
        }

        function updateHistory() {
            const historyList = document.getElementById('historyList');
            
            if (workouts.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No workouts logged yet. Start by logging your first workout!</p>';
                return;
            }

            const sortedWorkouts = [...workouts].sort((a, b) => new Date(b.date) - new Date(a.date));

            historyList.innerHTML = sortedWorkouts.map(workout => {
                let detailsHtml = '';
                
                if (workout.type === 'cardio' && workout.cardioData) {
                    const cd = workout.cardioData;
                    detailsHtml = `
                        Duration: ${cd.duration} minutes<br>
                        ${cd.distance ? `Distance: ${cd.distance} miles<br>` : ''}
                        ${cd.avgHeartRate ? `Avg HR: ${cd.avgHeartRate} bpm<br>` : ''}
                        ${cd.calories ? `<em>Calories: ${cd.calories}</em>` : ''}
                    `;
                } else if (workout.sets) {
                    const totalVolume = workout.sets.reduce((sum, set) => sum + (set.weight * set.reps), 0);
                    const setsInfo = workout.sets.map(set => `${set.weight}lbs √ó ${set.reps}`).join(', ');
                    detailsHtml = `
                        ${workout.sets.length} sets: ${setsInfo}<br>
                        <em>Total Volume: ${totalVolume} lbs</em>
                    `;
                }
                
                return `
                    <div class="history-item">
                        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;">
                            <div style="flex: 1; min-width: 200px;">
                                <div class="history-date">${new Date(workout.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                                <div class="history-exercise">
                                    <strong>${workout.exercise}</strong><br>
                                    ${detailsHtml}
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: start;">
                                <button class="btn btn-small" onclick="deleteWorkout(${workout.id})" style="background: #e74c3c; min-width: 60px;">Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteWorkout(id) {
            if (!confirm('Are you sure you want to delete this workout?')) {
                return;
            }

            workouts = workouts.filter(w => w.id !== id);
            localStorage.setItem('workouts', JSON.stringify(workouts));
            
            updateHistory();
            updateDashboard();
        }

        function logBodyWeight() {
            const date = document.getElementById('bodyWeightDate').value;
            const weight = parseFloat(document.getElementById('bodyWeight').value);

            if (!date || !weight) {
                alert('Please enter both date and body weight');
                return;
            }

            if (weight < 50 || weight > 500) {
                alert('Please enter a valid body weight (50-500 lbs)');
                return;
            }

            const entry = {
                id: Date.now(),
                date,
                weight
            };

            bodyWeights.push(entry);
            localStorage.setItem('bodyWeights', JSON.stringify(bodyWeights));

            // Show success message
            const successMsg = document.getElementById('bodyWeightSuccess');
            successMsg.classList.add('show');
            setTimeout(() => successMsg.classList.remove('show'), 3000);

            // Reset form
            document.getElementById('bodyWeight').value = '';
            document.getElementById('bodyWeightDate').valueAsDate = new Date();

            // Update displays
            updateBodyWeightChart();
            updateBodyWeightHistory();
        }

        function updateBodyWeightChart() {
            if (bodyWeights.length === 0) {
                if (bodyWeightChart) {
                    bodyWeightChart.destroy();
                    bodyWeightChart = null;
                }
                return;
            }

            const sortedWeights = [...bodyWeights].sort((a, b) => new Date(a.date) - new Date(b.date));
            const dates = sortedWeights.map(w => new Date(w.date).toLocaleDateString());
            const weights = sortedWeights.map(w => w.weight);

            const ctx = document.getElementById('bodyWeightChart').getContext('2d');

            if (bodyWeightChart) {
                bodyWeightChart.destroy();
            }

            bodyWeightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Body Weight (lbs)',
                        data: weights,
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointBackgroundColor: '#764ba2',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Weight (lbs)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateBodyWeightHistory() {
            const historyList = document.getElementById('bodyWeightHistoryList');
            
            if (bodyWeights.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No body weight entries yet. Start tracking your progress!</p>';
                return;
            }

            const sortedWeights = [...bodyWeights].sort((a, b) => new Date(b.date) - new Date(a.date));

            historyList.innerHTML = sortedWeights.map((entry, index) => {
                let changeHtml = '';
                if (index < sortedWeights.length - 1) {
                    const previousWeight = sortedWeights[index + 1].weight;
                    const change = entry.weight - previousWeight;
                    const changeColor = change > 0 ? '#e74c3c' : '#27ae60';
                    const changeSymbol = change > 0 ? '+' : '';
                    changeHtml = `<span style="color: ${changeColor}; font-weight: bold;"> (${changeSymbol}${change.toFixed(1)} lbs)</span>`;
                }
                
                return `
                    <div class="history-item">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div class="history-date">${new Date(entry.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                                <div class="history-exercise">
                                    <strong>${entry.weight} lbs</strong>${changeHtml}
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-small btn-secondary" onclick="editBodyWeight(${entry.id})" style="min-width: 60px;">Edit</button>
                                <button class="btn btn-small" onclick="deleteBodyWeight(${entry.id})" style="background: #e74c3c; min-width: 60px;">Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editBodyWeight(id) {
            const entry = bodyWeights.find(e => e.id === id);
            if (!entry) return;

            const newWeight = prompt(`Edit body weight (current: ${entry.weight} lbs):`, entry.weight);
            if (newWeight === null) return; // User cancelled

            const weight = parseFloat(newWeight);
            if (isNaN(weight) || weight < 50 || weight > 500) {
                alert('Please enter a valid body weight (50-500 lbs)');
                return;
            }

            entry.weight = weight;
            localStorage.setItem('bodyWeights', JSON.stringify(bodyWeights));
            
            updateBodyWeightChart();
            updateBodyWeightHistory();
        }

        function deleteBodyWeight(id) {
            if (!confirm('Are you sure you want to delete this body weight entry?')) {
                return;
            }

            bodyWeights = bodyWeights.filter(e => e.id !== id);
            localStorage.setItem('bodyWeights', JSON.stringify(bodyWeights));
            
            updateBodyWeightChart();
            updateBodyWeightHistory();
        }

        function showSection(sectionName, event) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(sectionName).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            }

            if (sectionName === 'dashboard') {
                updateDashboard();
            } else if (sectionName === 'history') {
                updateHistory();
            } else if (sectionName === 'bodycomp') {
                updateBodyWeightChart();
                updateBodyWeightHistory();
            } else if (sectionName === 'settings') {
                updateSettingsStats();
            }
        }

        function updateSettingsStats() {
            document.getElementById('settingsWorkoutCount').textContent = workouts.length;
            document.getElementById('settingsBodyWeightCount').textContent = bodyWeights.length;
        }

        function exportData() {
            const data = {
                workouts: workouts,
                bodyWeights: bodyWeights,
                exportDate: new Date().toISOString(),
                appVersion: '1.0'
            };

            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `polaris-workout-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('‚úÖ Data exported successfully! Check your Downloads folder or choose where to save it.');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.workouts && !data.bodyWeights) {
                        alert('‚ùå Invalid data file. Please select a valid Polaris workout data file.');
                        return;
                    }

                    // Merge imported data with existing data
                    if (data.workouts && Array.isArray(data.workouts)) {
                        // Add imported workouts that don't already exist (by id)
                        const existingIds = new Set(workouts.map(w => w.id));
                        const newWorkouts = data.workouts.filter(w => !existingIds.has(w.id));
                        workouts = [...workouts, ...newWorkouts];
                        localStorage.setItem('workouts', JSON.stringify(workouts));
                    }

                    if (data.bodyWeights && Array.isArray(data.bodyWeights)) {
                        // Add imported body weights that don't already exist (by id)
                        const existingIds = new Set(bodyWeights.map(w => w.id));
                        const newBodyWeights = data.bodyWeights.filter(w => !existingIds.has(w.id));
                        bodyWeights = [...bodyWeights, ...newBodyWeights];
                        localStorage.setItem('bodyWeights', JSON.stringify(bodyWeights));
                    }

                    alert(`‚úÖ Data imported successfully!\n\nWorkouts: ${workouts.length}\nBody Weight Entries: ${bodyWeights.length}`);
                    
                    // Update all displays
                    updateSettingsStats();
                    updateDashboard();
                    updateHistory();
                    updateBodyWeightChart();
                    updateBodyWeightHistory();

                } catch (error) {
                    alert('‚ùå Error importing data. Please make sure you selected a valid Polaris data file.');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
            
            // Reset the file input
            event.target.value = '';
        }

        function clearAllData() {
            const confirmation = confirm('‚ö†Ô∏è Are you ABSOLUTELY SURE you want to delete ALL your workout data?\n\nThis will permanently delete:\n- All workout logs\n- All body weight entries\n- All progress history\n\nThis action CANNOT be undone!\n\nConsider exporting your data first.');
            
            if (!confirmation) return;

            const doubleConfirm = confirm('üö® FINAL WARNING: This will delete EVERYTHING. Are you sure?');
            
            if (!doubleConfirm) return;

            // Clear all data
            workouts = [];
            bodyWeights = [];
            localStorage.removeItem('workouts');
            localStorage.removeItem('bodyWeights');

            alert('‚úÖ All data has been cleared.');

            // Update all displays
            updateSettingsStats();
            updateDashboard();
            updateHistory();
            updateBodyWeightChart();
            updateBodyWeightHistory();
        }
    </script>
</body>
</html>